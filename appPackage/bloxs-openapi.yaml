openapi: 3.0.3
info:
  title: Bloxs Real Estate OData API
  description: |
    OData API for Bloxs real estate management. Read-only access to properties, tenants, contracts, and maintenance.
    
    ## OData Query Parameters
    - **$filter**: Filter results (e.g., `OccupationPercentage lt 1`, `IsEnded eq false`)
    - **$select**: Select fields (e.g., `UnitId,DisplayName,DisplayAddress`)
    - **$orderby**: Sort results (e.g., `StartDate desc`)
    - **$top**: Limit results (max 500, default 50)
    - **$skip**: Skip for pagination
    - **$count**: Include count (true/false)
  version: "2.0.0"
  contact:
    name: Bloxs Software
    url: https://www.bloxs.com
servers:
  - url: https://bloxs-proxy.garfieldapp.workers.dev/odatafeed
    description: Bloxs OData Proxy
security:
  - bearerAuth: []

paths:
  # ==================== CORE ENTITIES ====================
  /Units:
    get:
      operationId: getUnits
      summary: Get rental units
      description: |
        Retrieve rental units (apartments, offices, retail spaces).
        Key fields: UnitId, RealEstateObjectId, DisplayName, DisplayAddress, OwnerId, Owner, OccupationPercentage,
        ActiveContractRentId, ActiveContractRentTenantId, CategoryName, ComplexName, ComplexId,
        SectionId, SectionName, RawFloorArea, RentableFloorArea, EnergyLabel, ManagementState,
        TechnicalManagement, FinancialManagement.
        
        Vacancy detection workflow:
        1. Filter: OccupationPercentage lt 1 and not contains(DisplayName,'VERKOCHT')
        2. Verify: ActiveContractRentId is null
        3. External management check (TWO-TIER - supports partial external management):
           - For each unique ComplexId, query FinancialMutations($filter=year(TransactionDate) eq 2026 and RealEstateObjectId eq ComplexRealEstateObjectId,$top=1)
           - If parent complex HAS transactions: check EACH unit individually
           - Query FinancialMutations($filter=year(TransactionDate) eq 2026 and RealEstateObjectId eq UnitRealEstateObjectId,$top=1)
           - Units WITH own transactions = internally managed (INCLUDE in vacancy list)
           - Units WITHOUT own transactions = externally managed (EXCLUDE from vacancy list)
        4. Calculate financial impact: TheoreticalRentItems for remaining internally managed vacant units
        5. Report separately: (1) Internally managed vacancies (actionable), (2) Externally managed count (info only)
        
        CRITICAL: Never assume all units in a complex are externally managed just because the parent has transactions.
        CRITICAL: Always do unit-level transaction check to support partial external management.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with units
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Buildings:
    get:
      operationId: getBuildings
      summary: Get buildings
      description: |
        Retrieve buildings (standalone properties).
        Key fields: BuildingId, DisplayName, DisplayAddress, OwnerId, Owner, CategoryName.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with buildings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Complexes:
    get:
      operationId: getComplexes
      summary: Get complexes
      description: |
        Retrieve complexes (collections of units under one roof).
        Key fields: ComplexId, DisplayName, Owner, OccupationPercentage.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with complexes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /CommercialOverview:
    get:
      operationId: getCommercialOverview
      summary: Get commercial portfolio overview
      description: |
        Quick portfolio overview with tenant, owner, rent info - NO JOINS NEEDED.
        Key fields: RealEstateObjectId, Address, OwnerName, TenantName, IsOccupied, BareRent_Yearly_TotalAmountExcl, ContractStartDate, ContractEndDate.
        IMPORTANT: rent field is BareRent_Yearly_TotalAmountExcl (not BareRent).
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with commercial overview
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /CommercialOverviewSpecific:
    get:
      operationId: getCommercialOverviewSpecific
      summary: Get extended commercial overview
      description: |
        Extended commercial overview (superset of CommercialOverview) for deeper analysis.
        Useful fields include: FutureContractStartDate, TotalAmountTheoreticalRent, EnergyLabel, ContractRemarks,
        AdministratorName, FinancierName, EstateAgentName.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Sections:
    get:
      operationId: getSections
      summary: Get sections
      description: |
        Sections within complexes.
        Key fields: SectionId, ComplexId, ComplexName, DisplayName, DisplayAddress, CategoryName.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /RealEstateObjects:
    get:
      operationId: getRealEstateObjects
      summary: Get real estate objects (base)
      description: |
        Base table for all real estate object types (Buildings, Complexes, Units, Sections).
        Key fields: RealEstateObjectId, DisplayName, DisplayAddress, CategoryName, OwnerId, Owner, OccupationPercentage,
        ActiveContractRentId, ActiveContractRentTenantId.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Addresses:
    get:
      operationId: getAddresses
      summary: Get addresses
      description: |
        Address records (street/city/postal code). Useful for enriching Relations/Persons/Owners and geodata.
        Key fields: AddressId, Street, HouseNumber, PostalCode, City, CountryId, Latitude, Longitude, DisplayName, StreetAndHouseNumber.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== RELATIONS ====================
  /Owners:
    get:
      operationId: getOwners
      summary: Get property owners
      description: |
        Retrieve property owners with contact info.
        Key fields: OwnerId, DisplayName, Reference, State, Email, RelationId.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with owners
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Persons:
    get:
      operationId: getPersons
      summary: Get persons (tenants, contacts)
      description: |
        Retrieve persons including tenants and contact persons.
        Key fields: PersonId, RelationId, DisplayName, FirstName, LastName, Email.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with persons
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Relations:
    get:
      operationId: getRelations
      summary: Get all relations
      description: |
        Base table for all relation types (persons, organisations, suppliers, owners).
        Key fields: RelationId, DisplayName, Reference, IsActive.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with relations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== CONTRACTS ====================
  /SalesContracts:
    get:
      operationId: getSalesContracts
      summary: Get rent contracts
      description: |
        Retrieve rent contracts with tenants.
        Key fields: SalesContractId, Reference, RelationName, OwnerName, StartDate, EndDate, IsEnded.
        Use IsEnded eq false for active contracts.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with contracts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /SalesContractRealestateObjects:
    get:
      operationId: getSalesContractRealestateObjects
      summary: Get contract-property links
      description: |
        JOIN TABLE linking SalesContracts to Units/Properties.
        Key fields: SalesContractId, RealEstateObjectId.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /SalesContractLineItems:
    get:
      operationId: getSalesContractLineItems
      summary: Get contract line item definitions (lookup table)
      description: |
        LOOKUP TABLE for contract line item types (not actual amounts!).
        Defines what types of charges exist per contract type (bare rent, service costs, etc.).
        Key fields: SalesContractLineItemId, Name, ContractType, LedgerAccountId, LedgerAccountCode, IsIndexable, IsBareRent, ItemType.
        NOTE: For actual rent amounts per property, use getSalesContractLines instead.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /SalesContractLine:
    get:
      operationId: getSalesContractLines
      summary: Get contract lines (property linkage)
      description: |
        Contract lines linked to real estate objects (best source for contract history per RealEstateObjectId).
        Use this to find contract history for a set of RealEstateObjectId values without sampling.

        Common fields: SalesContractLineId, SalesContractId, RealEstateObjectId, Description,
        AmountExcl, AmountVAT, AmountIncl, StartDate, EndDate, InvoiceInterval.

        Recommended workflow for history on a small list (e.g., 10–50 objects):
        1) Query SalesContractLine with a restrictive $filter using ORs on RealEstateObjectId.
        2) Collect distinct SalesContractId values.
        3) Query SalesContracts by those ids to get Reference/RelationName/IsEnded/StartDate/EndDate.
        4) Per object, determine the latest EndDate (or active if EndDate is null / IsEnded is false).
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== MAINTENANCE ====================
  /ServiceTickets:
    get:
      operationId: getServiceTickets
      summary: Get maintenance tickets
      description: |
        Maintenance service tickets - NO JOINS NEEDED, contains all names.
        Key fields: ServiceTicketId, Reference, RealEstateObjectName, TenantName, SupplierName, ServiceTicketStateName, ReportingDate, ClosingDate.
        For open tickets: first query ServiceTicketStates to find valid state names.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with service tickets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /ServiceTicketStates:
    get:
      operationId: getServiceTicketStates
      summary: Get valid ticket states
      description: |
        Discover valid ticket state names (tenant-specific).
        Key fields: ServiceTicketStateId, Name, SystemState (enum: Active/OnHold/SignedOff/Done), IsArchived.
        SystemState lets you programmatically determine open vs closed tickets.
        Query this first before filtering ServiceTickets by state.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with states
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /ServiceTicketProblemCategories:
    get:
      operationId: getServiceTicketProblemCategories
      summary: Get service ticket problem categories
      description: |
        Ticket problem categories (tenant-specific labels).
        Use to discover valid category names/ids before filtering ServiceTickets by ServiceTicketProblemCategoryName/Id.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /ServiceTicketCostCategories:
    get:
      operationId: getServiceTicketCostCategories
      summary: Get service ticket cost categories
      description: |
        Ticket cost categories (tenant-specific labels), often linked to ledger accounts.
        Use to discover valid category names/ids before filtering ServiceTickets by ServiceTicketCostCategoryName/Id.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== FINANCIALS ====================
  /FinancialMutations:
    get:
      operationId: getFinancialMutations
      summary: Get financial transactions
      description: |
        General ledger transactions - THE SOURCE for mortgage/loan data.
        Key fields: JournalPostTransactionId, JournalPostId, TransactionDate, LedgerAccountId, LedgerAccountCode,
        LedgerAccountName, Amount, Debit, Credit, Description, RealEstateObjectId, RealEstateObjectName,
        RelationId, RelationName, OwnerName, OwnerReference, FinancialYear, FinancialPeriod,
        JournalCode, JournalName, JournalType, InvoiceReference.
        ALWAYS use restrictive $filter and $top <= 100 (large table).
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /LedgerAccounts:
    get:
      operationId: getLedgerAccounts
      summary: Get chart of accounts
      description: |
        Chart of accounts (grootboekrekeningen).
        Key fields: LedgerAccountId, Code, Name, LedgerAccountType.
        Use contains(Name,'hypothe') to find mortgage accounts.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /SalesInvoices:
    get:
      operationId: getSalesInvoices
      summary: Get sales invoices
      description: |
        Sales invoices to tenants.
        Key fields: SalesInvoiceId, Reference, InvoiceDate, DueDate, TotalValueIncluding, OwnerName, RelationName, FinancialYear, WorkflowState.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /SalesInvoiceLines:
    get:
      operationId: getSalesInvoiceLines
      summary: Get sales invoice lines
      description: |
        Sales invoice line items. Use for property-level allocation (RealEstateObjectId/Name) and ledger breakdown.
        Recommended workflow: query SalesInvoices with a restrictive $filter, then query SalesInvoiceLines by SalesInvoiceId.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /PurchaseInvoices:
    get:
      operationId: getPurchaseInvoices
      summary: Get purchase invoices
      description: |
        Purchase invoices from suppliers - KEY for cost analysis.
        Key fields: PurchaseInvoiceId, Reference, InvoiceDate, TotalValueIncluding, RelationName, RealEstateObjectName, FinancialYear.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /PurchaseInvoiceLines:
    get:
      operationId: getPurchaseInvoiceLines
      summary: Get purchase invoice lines
      description: |
        Purchase invoice line items. Use when PurchaseInvoices does not carry RealEstateObjectName,
        or when you need line-level allocation by RealEstateObjectId and ledger account.
        Recommended workflow: query PurchaseInvoices with a restrictive $filter, then query PurchaseInvoiceLines by PurchaseInvoiceId.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /OpenPositionDebtors:
    get:
      operationId: getOpenPositionDebtors
      summary: Get outstanding receivables
      description: |
        Debtor aging report - outstanding amounts from tenants.
        Key fields: SalesInvoiceId, InvoiceDate, DueDate, Age, OutstandingAmount, RelationName, OwnerName.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /OpenPositionCreditors:
    get:
      operationId: getOpenPositionCreditors
      summary: Get outstanding payables
      description: |
        Creditor aging report - outstanding amounts to suppliers.
        Key fields: PurchaseInvoiceId, InvoiceDate, DueDate, Age, OutstandingAmount, RelationName.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /FinancingContracts:
    get:
      operationId: getFinancingContracts
      summary: Get financing contracts (loans/mortgages)
      description: |
        Loans/mortgages. Note: this table is often empty in practice; for mortgage insight, prefer FinancialMutations.
        Useful fields: FinancingContractId, Reference, StartDate, EndDate, Amount, RelationName (bank), OwnerName.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== VALUATIONS ====================
  /PropertyValuationValues:
    get:
      operationId: getPropertyValuationValues
      summary: Get WOZ values
      description: |
        WOZ values and property valuations.
        Key fields: PropertyValuationValueId, RealEstateObjectId, RealEstateObjectName, ValuationYear, Value, ValuationTypeName.
        Filter by ValuationYear eq 2026.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /TheoreticalRentItems:
    get:
      operationId: getTheoreticalRentItems
      summary: Get potential rent values
      description: |
        Potential/market rent per property - for vacancy impact analysis.
        Key fields: TheoreticalRentItemId, RealEstateObjectId, RealEstateObjectName, Amount, StartDate, EndDate.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== INSTALLATIONS & METERS ====================
  /Installations:
    get:
      operationId: getInstallations
      summary: Get installations
      description: |
        Equipment and installations (CV, lift, etc) with maintenance schedules.
        Key fields: InstallationId, Reference, Description, RealEstateObjectId,
        InstallationTypeId, SupplierId, BuildYear, NextMaintenanceOn, LastMaintainedOn,
        MaintenanceIntervalNumber, MaintenanceIntervalPeriod, ExpectedCosts, ArchiveDate, Remarks.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Meters:
    get:
      operationId: getMeters
      summary: Get utility meters
      description: |
        Utility meters (electricity, gas, water).
        Key fields: MeterId, RealEstateObjectId, CategoryName, EANCode.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /MeterReadings:
    get:
      operationId: getMeterReadings
      summary: Get meter readings
      description: |
        Meter reading values over time.
        Key fields: MeterReadingId, MeterId, ReadingDate, ReadingValue.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== TASKS & NOTES ====================
  /Tasks:
    get:
      operationId: getTasks
      summary: Get tasks and reminders
      description: |
        System tasks and reminders.
        Key fields: TaskId, Status, Deadline, ShowFromDate, TaskCategory.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Notes:
    get:
      operationId: getNotes
      summary: Get notes
      description: |
        Notes attached to entities.
        Key fields: NoteId, EntityLinkType, EntityId, CreatedOnTimeStamp.
        EntityLinkType is a numeric enum: Owner=1, Supplier=2, Organisation=3, Person=4, EstateAgent=5, Financier=6,
        Building=11, Complex=12, Unit=13, Section=14, Project=15,
        PrivateRentSalesContract=23, CommercialRentSalesContract=25, ServiceTicket=63, Installation=67.
        Example: $filter=EntityLinkType eq 13 and EntityId eq 123 (notes for Unit 123).
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== PURCHASE ORDERS ====================
  /PurchaseOrders:
    get:
      operationId: getPurchaseOrders
      summary: Get purchase orders
      description: |
        Purchase orders to suppliers. Tracks approval workflow and finalization.
        Key fields: PurchaseOrderId, Reference, OwnerId, RelationId, Subject, WorkflowState,
        TotalAmountExcl, FinalizationState (Open/Completed/Closed), FirstRealEstateObjectName,
        CurrentAssignedApproverDisplayName, ProposalReference, ProposalTotalAmountExcl.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /PurchaseOrderLines:
    get:
      operationId: getPurchaseOrderLines
      summary: Get purchase order lines
      description: |
        Purchase order line items with property allocation.
        Key fields: PurchaseOrderLineId, PurchaseOrderId, Description, LedgerAccountId,
        RealEstateObjectId, AmountExcl.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== PURCHASE CONTRACTS ====================
  /PurchaseContracts:
    get:
      operationId: getPurchaseContracts
      summary: Get supplier/purchase contracts
      description: |
        Supplier and purchase contracts (service agreements, private/commercial hire).
        Key fields: PurchaseContractId, Reference, Name, Type (Supplier/PrivateHire/CommercialHire),
        OwnerId, OwnerName, RelationId, RelationName, StartDate, EndDate, IsEnded,
        PaymentMethod, InvoiceInterval, NoticePeriod, NoticeDate.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /PurchaseContractLines:
    get:
      operationId: getPurchaseContractLines
      summary: Get purchase contract lines
      description: |
        Purchase contract line items with property allocation and amounts.
        Key fields: PurchaseContractLineId, PurchaseContractId, RealEstateObjectId,
        Description, AmountExcl, AmountIncl, StartDate, EndDate.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== COMMERCIAL RENT CONTRACTS ====================
  /CommercialRentSalesContracts:
    get:
      operationId: getCommercialRentSalesContracts
      summary: Get commercial rent contracts (with BreakOption)
      description: |
        Commercial rent contracts - superset of SalesContracts with BreakOption date.
        Key fields: CommercialRentSalesContractId, SalesContractId, BreakOption (break date!),
        Reference, RelationName, OwnerName, StartDate, EndDate, IsEnded, DepositAmount.
        Use BreakOption for commercial lease risk analysis.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== BUDGETS ====================
  /Budgets:
    get:
      operationId: getBudgets
      summary: Get budgets
      description: |
        Operating and investment budgets per owner per year.
        Key fields: BudgetId, BudgetType (OperatingBudget/InvestmentBudget), OwnerId, OwnerName,
        Name, FinancialYear.
        Combine with BudgetLedgerAccounts for monthly amounts per ledger account.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /BudgetLedgerAccounts:
    get:
      operationId: getBudgetLedgerAccounts
      summary: Get budget amounts per ledger account
      description: |
        Monthly budget amounts per ledger account. Perfect for budget vs actual analysis.
        Key fields: BudgetLedgerAccountId, BudgetId, LedgerAccountId, LedgerAccountCode,
        JanuaryAmount..DecemberAmount, TotalAmount.
        Workflow: getBudgets → BudgetId → getBudgetLedgerAccounts → compare with FinancialMutations.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== FINANCING DETAILS ====================
  /FinancingContractInstalments:
    get:
      operationId: getFinancingContractInstalments
      summary: Get loan/mortgage instalments
      description: |
        Instalment schedule for financing contracts (mortgage/loan repayments).
        Key fields: FinancingContractInstalmentId, FinancingContractId, InstalmentIndex,
        StartDate, EndDate, InterestPercentage, InstalmentStartAmount, Payment, Interest,
        Redemption, InstalmentEndAmount, IsEndSumLine.
        Use for detailed mortgage analysis: interest vs redemption breakdown.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== PAYMENT REMINDERS ====================
  /PaymentRemindersRelation:
    get:
      operationId: getPaymentRemindersRelation
      summary: Get payment reminder status per tenant
      description: |
        Payment reminder tracking per relation (tenant). Shows reminder phase and outstanding amounts.
        Key fields: PaymentReminderRelationId, OwnerId, OwnerName, RelationId, RelationName,
        TotalOutstandingAmount, LastActionOn, PaymentReminderPhase (None/FirstReminderSent/.../SentToDebtCollectingAgency),
        ExcludedUntil.
        Use for tenant risk assessment and collection follow-up.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== CONTROL LIST ====================
  /ControlList:
    get:
      operationId: getControlList
      summary: Get comprehensive control list (pre-joined)
      description: |
        PRE-JOINED comprehensive property/tenant/contract view - most complete single-query overview.
        Contains owner, property, unit, tenant, and contract details in one call.
        Key fields: Id, OwnerReference, OwnerName, OwnerAddress,
        RealEstateObjectReference, RealEstateObjectName, RealEstateObjectCategoryName,
        RealEstateObjectMandateAmount, RealEstateObjectCadastralNumber,
        UnitReference, UnitName, IsOccupied, BVO (bruto), VVO (verhuurbaar),
        TenantReference, TenantName, TenantIBAN, TenantAddress,
        SalesContractReference, SalesContractType, SalesContractStartDate, SalesContractEndDate,
        SalesContractNoticePeriod, SalesContractNoticeDate, SalesContractAutomaticExtension,
        SalesContractIndexationName, SalesContractNextIndexationDate,
        SalesContractPaymentMethod, SalesContractDepositAmount.
        PREFERRED over CommercialOverview when you need contract notice periods, cadastral numbers,
        mandate amounts, or detailed invoicing settings.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== INDEXATION ====================
  /IndexationMethods:
    get:
      operationId: getIndexationMethods
      summary: Get indexation methods
      description: |
        Indexation methods for rent adjustments.
        Key fields: IndexationMethodId, Name, Type (MonthlyIndex/YearlyIndex/FixedRate/FixedValue),
        IndexationSeriesName, MinimumIndexRate, MaximumIndexRate, FixedIndexRate, IncrementRate.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /IndexationSeriesValues:
    get:
      operationId: getIndexationSeriesValues
      summary: Get indexation series values (CPI data)
      description: |
        Indexation values per year/month for rent indexation series (e.g., CPI).
        Key fields: IndexationSeriesValueId, IndexationSeriesId, IndexationSeriesName,
        Value, CalendarYear, CalendarMonth.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== OWNER SETTLEMENTS ====================
  /OwnerSettlements:
    get:
      operationId: getOwnerSettlements
      summary: Get owner settlements
      description: |
        Owner settlements/statements (afrekeningen).
        Key fields: OwnerSettlementId, Reference, PeriodStart, PeriodEnd, OwnerName, TotalSettlementBalance.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      description: Bearer token for API authentication via proxy

  parameters:
    filter:
      name: $filter
      in: query
      description: |
        OData filter expression. Examples:
        - OccupationPercentage lt 1 (vacant units)
        - IsEnded eq false (active contracts)
        - contains(DisplayName,'straat')
        - FinancialYear eq 2026
      schema:
        type: string
    select:
      name: $select
      in: query
      description: Comma-separated fields to return (e.g., UnitId,DisplayName,DisplayAddress)
      schema:
        type: string
    orderby:
      name: $orderby
      in: query
      description: Sort field and direction (e.g., StartDate desc)
      schema:
        type: string
    top:
      name: $top
      in: query
      description: Maximum results (1-500, default 50)
      schema:
        type: integer
        minimum: 1
        maximum: 500
        default: 50
    skip:
      name: $skip
      in: query
      description: Number of results to skip for pagination
      schema:
        type: integer
        minimum: 0
        default: 0
    count:
      name: $count
      in: query
      description: Include total count in response
      schema:
        type: boolean
        default: false

  schemas:
    ODataResponse:
      type: object
      description: Standard OData response wrapper
      properties:
        '@odata.context':
          type: string
        '@odata.count':
          type: integer
        value:
          type: array
          items:
            type: object
            additionalProperties: true

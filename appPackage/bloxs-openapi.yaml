openapi: 3.0.3
info:
  title: Bloxs Real Estate OData API
  description: |
    OData API for Bloxs real estate management. Read-only access to properties, tenants, contracts, and maintenance.
    
    ## OData Query Parameters
    - **$filter**: Filter results (e.g., `OccupationPercentage lt 1`, `IsEnded eq false`)
    - **$select**: Select fields (e.g., `UnitId,DisplayName,DisplayAddress`)
    - **$orderby**: Sort results (e.g., `StartDate desc`)
    - **$top**: Limit results (max 500, default 50)
    - **$skip**: Skip for pagination
    - **$count**: Include count (true/false)
  version: "2.0.0"
  contact:
    name: Bloxs Software
    url: https://www.bloxs.com
servers:
  - url: https://bloxs-proxy.garfieldapp.workers.dev/odatafeed
    description: Bloxs OData Proxy
security:
  - bearerAuth: []

paths:
  # ==================== CORE ENTITIES ====================
  /Units:
    get:
      operationId: getUnits
      summary: Get rental units
      description: |
        Retrieve rental units (apartments, offices, retail spaces).
        Key fields: UnitId, DisplayName, DisplayAddress, OwnerId, Owner, OccupationPercentage, CategoryName, ComplexName.
        Use OccupationPercentage lt 1 to find vacant units.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with units
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Buildings:
    get:
      operationId: getBuildings
      summary: Get buildings
      description: |
        Retrieve buildings (standalone properties).
        Key fields: BuildingId, DisplayName, DisplayAddress, OwnerId, Owner, CategoryName.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with buildings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Complexes:
    get:
      operationId: getComplexes
      summary: Get complexes
      description: |
        Retrieve complexes (collections of units under one roof).
        Key fields: ComplexId, DisplayName, Owner, OccupationPercentage.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with complexes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /CommercialOverview:
    get:
      operationId: getCommercialOverview
      summary: Get commercial portfolio overview
      description: |
        Quick portfolio overview with tenant, owner, rent info - NO JOINS NEEDED.
        Key fields: RealEstateObjectId, Address, OwnerName, TenantName, IsOccupied, BareRent_Yearly_TotalAmountExcl, ContractStartDate, ContractEndDate.
        IMPORTANT: rent field is BareRent_Yearly_TotalAmountExcl (not BareRent).
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with commercial overview
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== RELATIONS ====================
  /Owners:
    get:
      operationId: getOwners
      summary: Get property owners
      description: |
        Retrieve property owners with contact info.
        Key fields: OwnerId, DisplayName, Reference, State, Email, RelationId.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with owners
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Persons:
    get:
      operationId: getPersons
      summary: Get persons (tenants, contacts)
      description: |
        Retrieve persons including tenants and contact persons.
        Key fields: PersonId, RelationId, DisplayName, FirstName, LastName, Email.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with persons
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Relations:
    get:
      operationId: getRelations
      summary: Get all relations
      description: |
        Base table for all relation types (persons, organisations, suppliers, owners).
        Key fields: RelationId, DisplayName, Reference, IsActive.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with relations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== CONTRACTS ====================
  /SalesContracts:
    get:
      operationId: getSalesContracts
      summary: Get rent contracts
      description: |
        Retrieve rent contracts with tenants.
        Key fields: SalesContractId, Reference, RelationName, OwnerName, StartDate, EndDate, IsEnded.
        Use IsEnded eq false for active contracts.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with contracts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /SalesContractRealestateObjects:
    get:
      operationId: getSalesContractRealestateObjects
      summary: Get contract-property links
      description: |
        JOIN TABLE linking SalesContracts to Units/Properties.
        Key fields: SalesContractId, RealEstateObjectId.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /SalesContractLineItems:
    get:
      operationId: getSalesContractLineItems
      summary: Get contract rent line items
      description: |
        Detailed rent line items with amounts per property.
        Key fields: SalesContractLineItemId, SalesContractId, RealEstateObjectId, RealEstateObjectName, Amount, StartDate, EndDate.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== MAINTENANCE ====================
  /ServiceTickets:
    get:
      operationId: getServiceTickets
      summary: Get maintenance tickets
      description: |
        Maintenance service tickets - NO JOINS NEEDED, contains all names.
        Key fields: ServiceTicketId, Reference, RealEstateObjectName, TenantName, SupplierName, ServiceTicketStateName, ReportingDate, ClosingDate.
        For open tickets: first query ServiceTicketStates to find valid state names.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with service tickets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /ServiceTicketStates:
    get:
      operationId: getServiceTicketStates
      summary: Get valid ticket states
      description: |
        Discover valid ticket state names (tenant-specific).
        Key fields: ServiceTicketStateId, Name, SortOrder.
        Query this first before filtering ServiceTickets by state.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response with states
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== FINANCIALS ====================
  /FinancialMutations:
    get:
      operationId: getFinancialMutations
      summary: Get financial transactions
      description: |
        General ledger transactions - THE SOURCE for mortgage/loan data.
        Key fields: JournalPostId, TransactionDate, LedgerAccountCode, Amount, RealEstateObjectName, RelationName, FinancialYear.
        ALWAYS use restrictive $filter and $top <= 100 (large table).
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /LedgerAccounts:
    get:
      operationId: getLedgerAccounts
      summary: Get chart of accounts
      description: |
        Chart of accounts (grootboekrekeningen).
        Key fields: LedgerAccountId, Code, Name, LedgerAccountType.
        Use contains(Name,'hypothe') to find mortgage accounts.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /SalesInvoices:
    get:
      operationId: getSalesInvoices
      summary: Get sales invoices
      description: |
        Sales invoices to tenants.
        Key fields: SalesInvoiceId, Reference, InvoiceDate, DueDate, TotalValueIncluding, OwnerName, RelationName, FinancialYear, WorkflowState.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /PurchaseInvoices:
    get:
      operationId: getPurchaseInvoices
      summary: Get purchase invoices
      description: |
        Purchase invoices from suppliers - KEY for cost analysis.
        Key fields: PurchaseInvoiceId, Reference, InvoiceDate, TotalValueIncluding, RelationName, RealEstateObjectName, FinancialYear.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /OpenPositionDebtors:
    get:
      operationId: getOpenPositionDebtors
      summary: Get outstanding receivables
      description: |
        Debtor aging report - outstanding amounts from tenants.
        Key fields: SalesInvoiceId, InvoiceDate, DueDate, Age, OutstandingAmount, RelationName, OwnerName.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== VALUATIONS ====================
  /PropertyValuationValues:
    get:
      operationId: getPropertyValuationValues
      summary: Get WOZ values
      description: |
        WOZ values and property valuations.
        Key fields: PropertyValuationValueId, RealEstateObjectId, RealEstateObjectName, ValuationYear, Value, ValuationTypeName.
        Filter by ValuationYear eq 2025.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /TheoreticalRentItems:
    get:
      operationId: getTheoreticalRentItems
      summary: Get potential rent values
      description: |
        Potential/market rent per property - for vacancy impact analysis.
        Key fields: TheoreticalRentItemId, RealEstateObjectId, RealEstateObjectName, Amount, StartDate, EndDate.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== INSTALLATIONS & METERS ====================
  /Installations:
    get:
      operationId: getInstallations
      summary: Get installations
      description: |
        Equipment and installations (CV, lift, etc) with maintenance schedules.
        Key fields: InstallationId, RealEstateObjectId, Name, InstallationTypeName, NextMaintenanceOn.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Meters:
    get:
      operationId: getMeters
      summary: Get utility meters
      description: |
        Utility meters (electricity, gas, water).
        Key fields: MeterId, RealEstateObjectId, CategoryName, EANCode.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /MeterReadings:
    get:
      operationId: getMeterReadings
      summary: Get meter readings
      description: |
        Meter reading values over time.
        Key fields: MeterReadingId, MeterId, ReadingDate, ReadingValue.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== TASKS & NOTES ====================
  /Tasks:
    get:
      operationId: getTasks
      summary: Get tasks and reminders
      description: |
        System tasks and reminders.
        Key fields: TaskId, Status, Deadline, ShowFromDate, TaskCategory.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  /Notes:
    get:
      operationId: getNotes
      summary: Get notes
      description: |
        Notes attached to entities.
        Key fields: NoteId, EntityLinkType, EntityId, CreatedOnTimeStamp.
        Filter by EntityLinkType and EntityId to get notes for a specific entity.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

  # ==================== OWNER SETTLEMENTS ====================
  /OwnerSettlements:
    get:
      operationId: getOwnerSettlements
      summary: Get owner settlements
      description: |
        Owner settlements/statements (afrekeningen).
        Key fields: OwnerSettlementId, Reference, PeriodStart, PeriodEnd, OwnerName, TotalSettlementBalance.
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/select'
        - $ref: '#/components/parameters/orderby'
        - $ref: '#/components/parameters/top'
        - $ref: '#/components/parameters/skip'
        - $ref: '#/components/parameters/count'
      responses:
        '200':
          description: OData response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ODataResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      description: Bearer token for API authentication via proxy

  parameters:
    filter:
      name: $filter
      in: query
      description: |
        OData filter expression. Examples:
        - OccupationPercentage lt 1 (vacant units)
        - IsEnded eq false (active contracts)
        - contains(DisplayName,'straat')
        - FinancialYear eq 2025
      schema:
        type: string
    select:
      name: $select
      in: query
      description: Comma-separated fields to return (e.g., UnitId,DisplayName,DisplayAddress)
      schema:
        type: string
    orderby:
      name: $orderby
      in: query
      description: Sort field and direction (e.g., StartDate desc)
      schema:
        type: string
    top:
      name: $top
      in: query
      description: Maximum results (1-500, default 50)
      schema:
        type: integer
        minimum: 1
        maximum: 500
        default: 50
    skip:
      name: $skip
      in: query
      description: Number of results to skip for pagination
      schema:
        type: integer
        minimum: 0
        default: 0
    count:
      name: $count
      in: query
      description: Include total count in response
      schema:
        type: boolean
        default: false

  schemas:
    ODataResponse:
      type: object
      description: Standard OData response wrapper
      properties:
        '@odata.context':
          type: string
        '@odata.count':
          type: integer
        value:
          type: array
          items:
            type: object
            additionalProperties: true

# yaml-language-server: $schema=https://aka.ms/teams-toolkit/v1.8/yaml.schema.json
# Visit https://aka.ms/teamsfx-v5.0-guide for details on this file
# Used for local debugging

version: v1.8

provision:
  - uses: teamsApp/create
    with:
      name: Bloxs-local
    writeToEnvironmentFile:
      teamsAppId: TEAMS_APP_ID

  - uses: apiKey/register
    with:
      name: bloxsApiKeyLocal
      appId: ${{TEAMS_APP_ID}}
      apiSpecPath: ./appPackage/bloxs-openapi.yaml
    writeToEnvironmentFile:
      registrationId: BLOXS_API_KEY_REFERENCE

  - uses: teamsApp/validateManifest
    with:
      manifestPath: ./appPackage/manifest.json

  - uses: teamsApp/zipAppPackage
    with:
      manifestPath: ./appPackage/manifest.json
      outputZipPath: ./appPackage/build/appPackage.${{TEAMSFX_ENV}}.zip
      outputFolder: ./appPackage/build

  - uses: teamsApp/validateAppPackage
    with:
      appPackagePath: ./appPackage/build/appPackage.${{TEAMSFX_ENV}}.zip

  - uses: teamsApp/update
    with:
      appPackagePath: ./appPackage/build/appPackage.${{TEAMSFX_ENV}}.zip

  - uses: teamsApp/extendToM365
    with:
      appPackagePath: ./appPackage/build/appPackage.${{TEAMSFX_ENV}}.zip
    writeToEnvironmentFile:
      titleId: M365_TITLE_ID
      appId: M365_APP_ID
